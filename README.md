# AWS運用で使えるスクリプト30選
個人的なPythonプログラミング練習として、AWS運用で利用できるスクリプトを作成し共有する。

## スクリプト
難易度イメージとして、ざっくり

* ⭐：すぐ書ける
* ⭐⭐：少し構造化・設計が必要
* ⭐⭐⭐：ちゃんと設計して育てていくタイプ
  もつけておきます。

### 1〜10：サーバ状態チェック系

1. **ディスク使用率チェック & アラート送信スクリプト（⭐〜⭐⭐）**

   * `df -h` や `/proc` を見て、閾値超えたらログ出力＋終了コード1で終了。
   * 後でSlackやメール連携を追加しても良い題材。

2. **特定ディレクトリ別のディスク使用ランキング出力（⭐）**

   * `/var/log` やアプリディレクトリ配下のサイズを集計し、上位10ディレクトリを表示。

3. **メモリ・スワップ使用率チェック（⭐）**

   * `/proc/meminfo` を読み取って、使用率が一定以上なら警告を出すCLI。

4. **CPU高負荷プロセス一覧出力ツール（⭐）**

   * `ps` or `/proc` を使って、CPU使用率が高いプロセスTop Nを表示。

5. **サービス（systemd）死活監視スクリプト（⭐⭐）**

   * チェック対象サービス名のリストを設定ファイルから読んで、`systemctl is-active` で状態確認、落ちていればログ＋終了コード1。

6. **NTP/chronyの時刻同期状態チェック（⭐）**

   * `chronyc tracking` 等を叩いてオフセットが許容範囲内か確認。

7. **TCPポート開放チェックスクリプト（⭐⭐）**

   * 設定ファイルに `"host:port"` を列挙し、`socket` モジュールで接続可否を確認、結果を一覧表示。

8. **特定URLへのHTTP/HTTPSヘルスチェック（⭐）**

   * EC2からアプリのヘルスチェックURLにアクセスしてステータスコード200を確認。

9. **OSパッチ適用要否チェック（yum/dnf list updates）（⭐⭐）**

   * `dnf check-update` を叩いて、アップデート候補があるかどうかだけを要約して表示。

10. **再起動が必要かどうかの簡易チェック（⭐）**

    * RHEL系で、特定ファイル（例：`/var/run/reboot-required` 的な自前フラグ）やカーネルバージョンの差分を見て、「再起動必要です」表示。


### 11〜20：ログ・バックアップ・ファイル系

11. **古いログファイルの自動削除スクリプト（⭐⭐）**

    * 指定ディレクトリ以下で「○日以上前のファイルを削除」＋ドライラン機能（`--dry-run`）付き。

12. **ログローテート後のファイル存在確認スクリプト（⭐）**

    * 前日分のローテートファイルが存在するかチェックして結果を出す。

13. **アプリログからエラーカウントを集計してレポート出力（⭐⭐）**

    * 前日分のログから `"ERROR"` 行数や特定エラーコードの件数を集計して標準出力にサマリ表示。

14. **指定フォルダの差分チェック（⭐⭐）**

    * 昨日と今日のファイルリストを比較して、追加・削除・変更ファイルを一覧化する（ハッシュやサイズ比較）。

15. **S3へのバックアップアップロードスクリプト（⭐⭐〜⭐⭐⭐）**

    * `boto3` で特定フォルダをtar.gzに固めてS3にアップロードし、結果をログ出力。

16. **バックアップファイルの整合性チェック（⭐⭐）**

    * S3上のバックアップファイルの一覧から、「○日分すべて揃っているか」を確認。

17. **特定ファイルの行数・容量監視（⭐）**

    * ログファイルのサイズ・行数が想定以上に増えていないかをチェックして出力。

18. **CSV/TSVデータの簡易バリデーションスクリプト（⭐⭐）**

    * カラム数・必須カラムの空欄・日付形式チェックなどを行い、エラー件数を出す。

19. **ログ中の特定パターン（例：タイムアウト）の統計レポート（⭐⭐）**

    * 正規表現でヒットしたパターンをカウントし、「どの時間帯に多いか」まで簡単に集計。

20. **巨大ログファイルの分割スクリプト（⭐）**

    * 1GB以上のログをN行ごとに分割して別ファイルとして保存。


### 21〜30：AWS連携・セキュリティ・便利ツール系

21. **EC2のインスタンスメタデータ取得＆環境情報出力ツール（⭐）**

    * IMDSv2を叩いてインスタンスタイプ・AZ・IAMロール名などをJSONで表示。

22. **EC2タグから設定値を読み込むスクリプト（⭐⭐）**

    * `boto3` で自身のインスタンスIDを取得し、タグから「env」「role」などを取得 → 設定ファイルのように使う。

23. **CloudWatch Logs へのテストログ送信スクリプト（⭐⭐）**

    * `boto3` で指定のロググループ／ストリームにテストメッセージを数件送って、権限・設定確認。

24. **CloudWatch メトリクスの簡易取得・表示ツール（⭐⭐〜⭐⭐⭐）**

    * CPUUtilization や StatusCheckFailed などを一定期間で取得し、平均・最大値を表示。

25. **セキュリティグループの自己チェック（⭐⭐⭐）**

    * 自身のEC2に付いているSGを `boto3` で取得し、「0.0.0.0/0 で 22番が空いていないか」などの簡易チェックを実施。

26. **ウイルス対策ソフト（例：clamscan等）のスキャン結果サマリスクリプト（⭐⭐）**

    * スキャンログから検出数・検出ファイル一覧だけを抽出し、サマリとして出力。

27. **ユーザー・グループの設定チェックツール（⭐⭐）**

    * `/etc/passwd`, `/etc/group` を読み取り、ポリシー違反（例：UID 0 が複数存在、禁止ユーザー名など）がないかチェック。

28. **SSH接続元IPの集計レポート（⭐⭐）**

    * `/var/log/secure` などから、過去24時間のSSH接続元IPトップ10を集計。

29. **定期ジョブ（cron / systemd timer）設定の一覧化チェック（⭐⭐）**

    * `crontab -l` や `/etc/cron.d/`, systemd timer を走査して、「どんなジョブが設定されているか」を一覧表示。

30. **運用スクリプト実行結果の標準フォーマット出力器（⭐⭐〜⭐⭐⭐）**

    * どのスクリプトにも共通で使える「結果JSONを標準出力に出すための小さなライブラリ」
      （`status: success/failure, message, details` など）を作って、他スクリプトから利用。

## どれからやると良さそうか
まずは **シンプルで完結しているもの → そこから少しずつAWSや設計要素を増やす** のが良いと思います。

* 第一弾候補：
  * 1. ディスク使用率チェック
  * 11. 古いログ削除
  * 14. 差分チェック

* 第二弾候補：
  * 15. S3バックアップアップロード
  * 22. EC2タグから設定値取得
  * 24. CloudWatchメトリクス取得


    * どのスクリプトにも共通で使える「結果JSONを標準出力に出すための小さなライブラリ」
      （`status: success/failure, message, details` など）を作って、他スクリプトから利用。
